<?php

namespace Kitsune\ClubPenguin\Handlers\Play;

use Kitsune\ClubPenguin\Packets\Packet;
use Kitsune\ClubPenguin\Handlers\Game\Jitsu;

trait Ninja {

	protected function handleGetNinjaRank($socket) {
		$penguin = $this->penguins[$socket];
		if(is_numeric(Packet::$Data[2])) {
        $playerId = Packet::$Data[2];
        }
		if($penguin->database->playerIdExists($playerId)) {
			$penguin->send("%xt%gnr%-1%");
			//$penguin->send("%xt%gnr%-1%$playerId%0%0%0%0%");
		}
	}
  
	public function handleGetNinjaLevel($socket){
		$penguin = $this->penguins[$socket];
		$penguin->send("%xt%gnl%-1%{$penguin->NinjaBelt}%{$penguin->NinjaPercentage}%10%");
	}

	public function array_count_values_of($value, $array) {
		$counts = array_count_values($array);
		return $counts[$value];
	}


/*
	This code is vulnerable to DOS.
	$this->cards is located in World.php with the following:
	$cards = $downloadAndDecode("https://icer.ink/media1.clubpenguin.com/play/web_service/game_configs/cards.json");
		$index = 0;
		foreach($cards as $cardId => $cardItem) {
			$cardId = $cardItem["card_id"];
			$this->cards[$index] = array($cardId, $cardItem["element"], $cardItem["value"], $cardItem["color"], $cardItem['power_id']);
			$this->cardsArray[$index] = $index . '|' . $cardId . '|' .$cardItem["element"]. '|' .$cardItem["value"]. '|'.$cardItem["color"].'|' .$cardItem['power_id'];
			$index++;
		}

	It gets all the cards. This is bad as the packet is huge.
	%xt%gcd%-1%1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0|37,1,0|38,1,0|39,1,0|40,1,0|41,1,0|42,1,0|43,1,0|44,1,0|45,1,0|46,1,0|47,1,0|48,1,0|49,1,0|50,1,0|51,1,0|52,1,0|53,1,0|54,1,0|55,1,0|56,1,0|57,1,0|58,1,0|59,1,0|60,1,0|61,1,0|62,1,0|63,1,0|64,1,0|65,1,0|66,1,0|67,1,0|68,1,0|69,1,0|70,1,0|71,1,0|72,1,0|73,1,0|74,1,0|75,1,0|76,1,0|77,1,0|78,1,0|79,1,0|80,1,0|81,1,0|82,1,0|83,1,0|84,1,0|85,1,0|86,1,0|87,1,0|88,1,0|89,1,0|90,1,0|91,1,0|92,1,0|93,1,0|94,1,0|95,1,0|96,1,0|97,1,0|98,1,0|99,1,0|100,1,0|101,1,0|102,1,0|103,1,0|104,1,0|105,1,0|106,1,0|107,1,0|108,1,0|109,1,0|110,1,0|111,1,0|112,1,0|113,1,0|201,1,0|202,1,0|203,1,0|204,1,0|205,1,0|206,1,0|207,1,0|208,1,0|209,1,0|210,1,0|211,1,0|212,1,0|213,1,0|214,1,0|215,1,0|216,1,0|217,1,0|218,1,0|219,1,0|220,1,0|221,1,0|222,1,0|223,1,0|224,1,0|225,1,0|226,1,0|227,1,0|228,1,0|229,1,0|230,1,0|231,1,0|232,1,0|233,1,0|234,1,0|235,1,0|236,1,0|237,1,0|238,1,0|239,1,0|240,1,0|241,1,0|242,1,0|243,1,0|244,1,0|245,1,0|246,1,0|247,1,0|248,1,0|249,1,0|250,1,0|251,1,0|252,1,0|253,1,0|254,1,0|255,1,0|256,1,0|257,1,0|258,1,0|259,1,0|260,1,0|301,1,0|302,1,0|303,1,0|304,1,0|305,1,0|306,1,0|307,1,0|308,1,0|309,1,0|310,1,0|311,1,0|312,1,0|313,1,0|314,1,0|315,1,0|316,1,0|317,1,0|318,1,0|319,1,0|320,1,0|321,1,0|322,1,0|323,1,0|324,1,0|325,1,0|326,1,0|327,1,0|328,1,0|329,1,0|330,1,0|331,1,0|332,1,0|333,1,0|334,1,0|335,1,0|336,1,0|337,1,0|338,1,0|339,1,0|340,1,0|341,1,0|342,1,0|343,1,0|344,1,0|345,1,0|346,1,0|347,1,0|348,1,0|349,1,0|350,1,0|351,1,0|352,1,0|353,1,0|354,1,0|355,1,0|356,1,0|357,1,0|358,1,0|359,1,0|360,1,0|401,1,0|402,1,0|403,1,0|404,1,0|405,1,0|406,1,0|407,1,0|408,1,0|409,1,0|410,1,0|411,1,0|412,1,0|413,1,0|414,1,0|415,1,0|416,1,0|417,1,0|418,1,0|419,1,0|420,1,0|421,1,0|422,1,0|423,1,0|424,1,0|425,1,0|426,1,0|427,1,0|501,1,0|502,1,0|503,1,0|504,1,0|505,1,0|506,1,0|507,1,0|508,1,0|509,1,0|510,1,0|511,1,0|512,1,0|513,1,0|514,1,0|515,1,0|516,1,0|517,1,0|518,1,0|519,1,0|520,1,0|521,1,0|522,1,0|523,1,0|524,1,0|525,1,0|526,1,0|527,1,0|528,1,0|529,1,0|530,1,0|531,1,0|532,1,0|533,1,0|534,1,0|535,1,0|536,1,0|537,1,0|538,1,0|539,1,0|540,1,0|541,1,0|542,1,0|543,1,0|544,1,0|545,1,0|546,1,0|547,1,0|548,1,0|549,1,0|550,1,0|551,1,0|552,1,0|553,1,0|554,1,0|555,1,0|556,1,0|557,1,0|558,1,0|559,1,0|560,1,0|561,1,0|562,1,0|563,1,0|564,1,0|565,1,0|566,1,0|567,1,0|568,1,0|569,1,0|570,1,0|571,1,0|572,1,0|573,1,0|574,1,0|575,1,0|576,1,0|577,1,0|578,1,0|579,1,0|580,1,0|581,1,0|582,1,0|583,1,0|584,1,0|585,1,0|586,1,0|587,1,0|588,1,0|589,1,0|590,1,0|591,1,0|592,1,0|593,1,0|594,1,0|595,1,0|601,1,0|602,1,0|603,1,0|604,1,0|605,1,0|606,1,0|607,1,0|608,1,0|609,1,0|610,1,0|611,1,0|612,1,0|613,1,0|614,1,0|615,1,0|616,1,0|617,1,0|618,1,0|619,1,0|620,1,0|621,1,0|622,1,0|623,1,0|624,1,0|625,1,0|626,1,0|627,1,0|628,1,0|629,1,0|630,1,0|631,1,0|632,1,0|633,1,0|634,1,0|635,1,0|636,1,0|637,1,0|638,1,0|639,1,0|640,1,0|641,1,0|642,1,0|643,1,0|644,1,0|645,1,0|646,1,0|647,1,0|648,1,0|649,1,0|650,1,0|651,1,0|652,1,0|653,1,0|654,1,0|655,1,0|656,1,0|657,1,0|658,1,0|659,1,0|660,1,0|661,1,0|662,1,0|663,1,0|664,1,0|665,1,0|666,1,0|667,1,0|668,1,0|669,1,0|670,1,0|671,1,0|672,1,0|673,1,0|674,1,0|675,1,0|676,1,0|677,1,0|678,1,0|679,1,0|680,1,0|681,1,0|682,1,0|683,1,0|684,1,0|685,1,0|686,1,0|687,1,0|688,1,0|689,1,0|690,1,0|691,1,0|692,1,0|693,1,0|694,1,0|695,1,0|696,1,0|697,1,0|698,1,0|699,1,0|700,1,0|701,1,0|702,1,0|703,1,0|704,1,0|705,1,0|706,1,0|707,1,0|708,1,0|709,1,0|710,1,0|711,1,0|712,1,0|713,1,0|714,1,0|715,1,0|716,1,0|717,1,0|718,1,0|719,1,0|720,1,0|721,1,0|722,1,0|723,1,0|724,1,0|725,1,0|726,1,0|727,1,0|728,1,0|729,1,0|730,1,0|731,1,0|732,1,0|733,1,0|734,1,0|735,1,0|736,1,0|737,1,0|738,1,0|739,1,0|740,1,0|741,1,0|742,1,0|743,1,0|744,1,0|745,1,0|746,1,0|747,1,0|748,1,0|749,1,0|750,1,0|801,1,0|802,1,0|803,1,0|804,1,0%.
	*/

	public function handleGetCardData($socket) {
		//card_id,card_quantity,ismemberonly
		$noBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0";
		$whiteBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0";
		$yellowBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0";
		$orangeBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0";
		$greenBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0|37,1,0|38,1,0|39,1,0|40,1,0|41,1,0|42,1,0|43,1,0";
		$blueBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0|37,1,0|38,1,0|39,1,0|40,1,0|41,1,0|42,1,0|43,1,0|44,1,0|45,1,0|46,1,0|47,1,0|48,1,0|49,1,0|50,1,0|51,1,0|52,1,0";
		$redBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0|37,1,0|38,1,0|39,1,0|40,1,0|41,1,0|42,1,0|43,1,0|44,1,0|45,1,0|46,1,0|47,1,0|48,1,0|49,1,0|50,1,0|51,1,0|52,1,0|53,1,0|54,1,0|55,1,0|56,1,0|57,1,0|58,1,0";
		$purpleBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0|37,1,0|38,1,0|39,1,0|40,1,0|41,1,0|42,1,0|43,1,0|44,1,0|45,1,0|46,1,0|47,1,0|48,1,0|49,1,0|50,1,0|51,1,0|52,1,0|53,1,0|54,1,0|55,1,0|56,1,0|57,1,0|58,1,0|59,1,0|60,1,0|61,1,0|62,1,0|63,1,0|64,1,0";
		$brownBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0|37,1,0|38,1,0|39,1,0|40,1,0|41,1,0|42,1,0|43,1,0|44,1,0|45,1,0|46,1,0|47,1,0|48,1,0|49,1,0|50,1,0|51,1,0|52,1,0|53,1,0|54,1,0|55,1,0|56,1,0|57,1,0|58,1,0|59,1,0|60,1,0|61,1,0|62,1,0|63,1,0|64,1,0|65,1,0|66,1,0|67,1,0|68,1,0|69,1,0|70,1,0|71,1,0|72,1,0|73,1,0";
		$blackBelt = "1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0|10,1,0|11,1,0|12,1,0|13,1,0|14,1,0|15,1,0|16,1,0|17,1,0|18,1,0|19,1,0|20,1,0|21,1,0|22,1,0|23,1,0|24,1,0|25,1,0|26,1,0|27,1,0|28,1,0|29,1,0|30,1,0|31,1,0|32,1,0|33,1,0|34,1,0|35,1,0|36,1,0|37,1,0|38,1,0|39,1,0|40,1,0|41,1,0|42,1,0|43,1,0|44,1,0|45,1,0|46,1,0|47,1,0|48,1,0|49,1,0|50,1,0|51,1,0|52,1,0|53,1,0|54,1,0|55,1,0|56,1,0|57,1,0|58,1,0|59,1,0|60,1,0|61,1,0|62,1,0|63,1,0|64,1,0|65,1,0|66,1,0|67,1,0|68,1,0|69,1,0|70,1,0|71,1,0|72,1,0|73,1,0|74,1,0|75,1,0|76,1,0|77,1,0|78,1,0|79,1,0|80,1,0|81,1,0|82,1,0|748,1,0|749,1,0|750,1,0|801,1,0|802,1,0|803,1,0|804,1,0";
		$penguin = $this->penguins[$socket];
		$cardsArray = array();
		foreach($this->cards as $cardIndex=>$cardArray) {
			array_push($cardsArray, sprintf("%d,%d,%d", $cardArray[0],1, 0));
		}
		$cardsString = implode("|", $cardsArray);
		$cardPatch = $penguin->database->getNinjaRank($penguin->id, "NinjaBelt");
		if ($cardPatch == 0){
			$penguin->send("%xt%gcd%-1%$noBelt%");
		} elseif ($cardPatch == 1) {
			$penguin->send("%xt%gcd%-1%$whiteBelt%");
		} elseif ($cardPatch == 2) {
			$penguin->send("%xt%gcd%-1%$yellowBelt%");
		} elseif ($cardPatch == 3) {
			$penguin->send("%xt%gcd%-1%$orangeBelt%");
		} elseif ($cardPatch == 4) {
			$penguin->send("%xt%gcd%-1%$greenBelt%");
		} elseif ($cardPatch == 5) {
			$penguin->send("%xt%gcd%-1%$blueBelt%");
		} elseif ($cardPatch == 6) {
			$penguin->send("%xt%gcd%-1%$redBelt%");
		} elseif ($cardPatch == 7) {
			$penguin->send("%xt%gcd%-1%$purpleBelt%");
		} elseif ($cardPatch == 8) {
			$penguin->send("%xt%gcd%-1%$brownBelt%");
		} elseif ($cardPatch == 9) {
			$penguin->send("%xt%gcd%-1%$blackBelt%");
		} else {
			return $this->removePenguin($penguin);
			echo "[CARD-JITSU PCL EXPLOIT]: $penguin->intIp"; // Will get on console.
		}
		/*
		The above will patch the DOS, but people will be able to add cards with WPE. To fix that, you should use this over database so people can't change it.
		here's an example:
		1. Create a column and name it "Cards"
		2. Auto set it to: 1,1,0|2,1,0|3,1,0|4,1,0|5,1,0|6,1,0|7,1,0|8,1,0|9,1,0 (Because everyone starts at 0)
		The actual code:

		$x = $penguin->database->checkCards($penguin->id, "Cards");
		$cardPatch = $penguin->database->getNinjaRank($penguin->id, "NinjaBelt");
		if($cardPatch == 0 || $x == $noBelt){
			$penguin->send("%xt%gcd%-1%$noBelt%");
		}
		// Continue for all and use this as the last statement:
		} else {
			return $this->removePenguin($penguin);
			echo "[CARD-JITSU CARD-HACK]: $penguin->intIp"; // Will get on console.
		}
		*/
	}

public function handleBuyPowerCards($socket) {
		$penguin = $this->penguins[$socket];
		$kek = Packet::$Data[2]; // String injection, patch if you want to use as3
		$kek2 = Packet::$Data[3]; // String injection, patch if you want to use as3
		$penguin->send("%xt%bpc%-1%$kek%$kek2%");
		//Send: %xt%s%cd#bpc%23%.
		//Receive: %xt%bpc%-1%1%15%.
	}

}

?>
